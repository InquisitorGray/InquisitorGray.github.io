---
layout: default
title: Конфигурация
nav_order: 2
parent: Эксплуатация
has_children: false
---

Конфигурация
============

Конфигурация системы задается в текстовом файле YAML-формата. Параметры конфигурации организованы 
в иерархическую структуру типа дерево.

Ниже представлен пример актуального файла конфигурации сервиса исполнения запросов системы 
с комментариями, поясняющими назначение параметров. Для наглядности описания параметры разделены 
по категориям на отдельные секции.

Настройки журналирования
------
``` yaml
# раздел настроек журналирования
logging:
# задание уровня важности сообщений, журналируемых в лог-файле
level:
io.arenadata.dtm.query.execution: TRACE
```

Настройки управления DTM
------
``` yaml
# раздел настроек управления DTM
management:
# номер порта сервиса метрик
server:
port: ${DTM\_METRICS\_PORT:8080}
# настройки конечных точек ADTM
endpoints:
# настройка генерации метрик со стороны ADTM
    enabled-by-default: ${DTM\_METRICS\_ENABLED:true}
# настройка видимости метрик через веб-соединения
    web:
      exposure:
# состав метрик, видимых через веб-соединения
        include: ${DTM\_METRICS\_SCOPE:info, health, requests}
```

Настройки сервиса исполнения запросов
------
``` yaml
# раздел настроек сервиса исполнения запросов
core:
# настройки плагинов
plugins:
# список работающих плагинов к соответствующим СУБД
    active: ${CORE\_PLUGINS\_ACTIVE:ADG, ADB, ADQM}
# настройки профилей приоритетности СУБД по категориям SQL-запросов
    category:
      mapping:
# профиль для общих реляционных запросов
        RELATIONAL: ${DTM\_CORE\_PLUGINS\_RELATIONAL:ADB, ADQM, ADG}
# профиль для запросов аналитики
        ANALYTICAL: ${DTM\_CORE\_PLUGINS\_ANALYTICAL:ADQM, ADB, ADG}
# профиль для запросов ключ-значение
        DICTIONARY: ${DTM\_CORE\_PLUGINS\_DICTIONARY:ADG, ADB, ADQM}
# профиль для других категорий запросов
        UNDEFINED:  ${DTM\_CORE\_PLUGINS\_UNDEFINED:ADB, ADQM, ADG}
# настройки сетевых подключений через HTTP-протокол
http:
# номер порта сервиса исполнения запросов
    port: ${DTM\_CORE\_HTTP\_PORT:9090}
# настройка режима оптимизации работы сокета TCP\_NODELAY
    tcpNoDelay: ${DTM\_CORE\_HTTP\_TCP\_NODELAY:true}
# настройка режима TCP FAST\_OPEN
    tcpFastOpen: ${DTM\_CORE\_HTTP\_TCP\_FAST\_OPEN:true}
# настройка режима оптимизации работы сокета TCP\_QUICKACK
    tcpQuickAck: ${DTM\_CORE\_HTTP\_TCP\_QUICK\_ACK:true}
# настройки окружения
env:
# имя окружения для формирования полных имен логических БД
    name: ${DTM\_NAME:test}
# настройки временной зоны
settings:
timeZone: ${CORE\_TIME\_ZONE:UTC}
# настройки генерации метрики сервиса исполнения запросов
metrics:
isEnabled: ${DTM\_CORE\_METRICS\_ENABLED:true}
# настройки источника данных
datasource:
# настройки для EDML-операторов
    edml:
# тип СУБД-источника (ADB, ADQM, ADG)
      sourceType: ${EDML\_DATASOURCE:ADB}
# количество записей, по умолчанию выгружаемых в одном сообщении топика Каfka
      defaultChunkSize: ${EDML\_DEFAULT\_CHUNK\_SIZE:1000}
# период проверки статуса плагина в миллисекундах
      pluginStatusCheckPeriodMs: ${EDML\_STATUS\_CHECK\_PERIOD\_MS:1000}
# интервал времени ожидания (в миллисекундах) до тайм-аута при работе с первым смещением в топике Kafka
      firstOffsetTimeoutMs: ${EDML\_FIRST\_OFFSET\_TIMEOUT\_MS:15000}
# интервал времени ожидания (в миллисекундах) до тайм-аута при ожидании смены смещения в топике Kafka
      changeOffsetTimeoutMs: ${EDML\_CHANGE\_OFFSET\_TIMEOUT\_MS:10000}
# настройки Zookeeper
    zookeeper:
# сетевой адрес хоста Zookeeper для служебной БД
      connection-string: ${ZOOKEEPER\_DS\_ADDRESS:10.92.3.47}
# интервал времени ожидания (в миллисекундах) соединения с хостом Zookeeper для служебной БД до достижения тайм-аута
      connection-timeout-ms: ${ZOOKEEPER\_DS\_CONNECTION\_TIMEOUT\_MS:30000}
# интервал времени бездействия (в миллисекундах) в сессии хоста Zookeeper для служебной БД до достижения тайм-аута
      session-timeout-ms: ${ZOOKEEPER\_DS\_SESSION\_TIMEOUT\_MS:86400000}
# корневой путь к хосту Zookeeper для служебной БД
      chroot: ${ZOOKEEPER\_DS\_CHROOT:/adtm}
# настройки взаимодействия сервиса исполнения запросов с брокером сообщений Kafka
kafka:
producer:
property:
# указание сериализатора строковых ключей
        key.serializer: org.apache.kafka.common.serialization.StringSerializer
# указание сериализатора строковых значений
        value.serializer: org.apache.kafka.common.serialization.StringSerializer
# настройка кластера Zookeeper для взаимодействия с брокером сообщений Kafka
    cluster:
      zookeeper:
# сетевой адрес хоста Zookeeper для брокера сообщений Kafka
        connection-string: ${ZOOKEEPER\_KAFKA\_ADDRESS:10.92.3.47}
# интервал времени ожидания (в миллисекундах) соединения с хостом Zookeeper для брокера сообщений Kafka до достижения тайм-аута
        connection-timeout-ms: ${ZOOKEEPER\_KAFKA\_CONNECTION\_TIMEOUT\_MS:30000}
# интервал времени бездействия (в миллисекундах) в сессии хоста Zookeeper для брокера сообщений Kafka до достижения тайм-аута
        session-timeout-ms: ${ZOOKEEPER\_KAFKA\_SESSION\_TIMEOUT\_MS:86400000}
# корневой путь к хосту Zookeeper для брокера сообщений Kafka
        chroot: ${ZOOKEEPER\_KAFKA\_CHROOT:}
# настройки администратора Kafka
    admin:
# интервал времени ожидания (в миллисекундах) входного потока данных для брокера сообщений Kafka до достижения тайм-аута
      inputStreamTimeoutMs: ${KAFKA\_INPUT\_STREAM\_TIMEOUT\_MS:2000}
# настройки статусов публикации событий брокером сообщений Kafka
    status.event.publish:
# разрешение на публикацию событий
      enabled: ${KAFKA\_STATUS\_EVENT\_ENABLED:false}
# наименование топика Kafka, в который публикуются события
      topic: ${KAFKA\_STATUS\_EVENT\_TOPIC:status.event}
# сетевой адрес, порт и путь к сервису мониторинга статусов Kafka
    statusMonitorUrl: ${STATUS\_MONITOR\_URL:http://127.0.0.1:9095/status}

# настройки при использовании фреймворка vertx
vertx:
pool:
# максимальный объем пула задач в сервисе исполнения запросов
      task-pool: ${DTM\_CORE\_TASK\_POOL\_SIZE:10}
# интервал времени завершения задачи, выполняемой в сервисе исполнения запросов
      task-timeout: ${DTM\_CORE\_TASK\_TIMEOUT:86400000}
# настройки кэширования запросов
cache:
# начальная емкость кэша
    initialCapacity: ${CACHE\_INITIAL\_CAPACITY:100000}
# максимальный размер кэша
    maximumSize: ${CACHE\_MAXIMUM\_SIZE:100000}
# время (в минутах) устаревания кэша после последнего момента обращения к нему
    expireAfterAccessMinutes: ${CACHE\_EXPIRE\_AFTER\_ACCESS\_MINUTES:99960}
```

Настройки СУБД ADB
------
``` yaml
\# настройка СУБД ADB
adb:
# настройка источника данных СУБД ADB
datasource:
# имя пользователя/логин для авторизации в СУБД ADB
    user: ${ADB\_USERNAME:dtm}
# пароль для авторизации в СУБД ADB
    password: ${ADB\_PASS:dtm}
# сетевой адрес хоста с СУБД ADB
    host: ${ADB\_HOST:10.92.3.105}
# сетевой адрес порта на хосте с СУБД ADB
    port: ${ADB\_PORT:5432}
# максимальный размер пула подключений к СУБД ADB
    maxSize: ${ADB\_MAX\_POOL\_SIZE:20}
# максимальный размер результата, возвращаемого по FETCH-запросу к СУБД ADB
    fetchSize: ${ADB\_FETCH\_SIZE:1000}
# признак использования исторических таблиц
with-history-table: ${ADB\_WITH\_HISTORY\_TABLE:false}
# настройки механизма загрузки данных в СУБД ADB
mppw:
# наименование консьюмер-группы СУБД ADB для взаимодействия с брокером сообщений Kafka
    consumerGroup: ${ADB\_LOAD\_GROUP:adb-emulator-load-adb}
# максимальный размер пула подключений к СУБД ADB для операций загрузки
    poolSize: ${ADB\_MPPW\_POOL\_SIZE:2}
# значение тайм-аута ожидания (в миллисекундах) для остановки загрузки
    stopTimeoutMs: ${ADB\_MPPW\_STOP\_TIMEOUT\_MS:86400000}
# предельное количество сообщений для операции загрузки в СУБД ADB
    defaultMessageLimit: ${ADB\_MPPW\_DEFAULT\_MESSAGE\_LIMIT:100}
# значение тайм-аута ожидания (в миллисекундах) для FDW-коннектора ADB
    fdwTimeoutMs: ${ADB\_MPPW\_FDW\_TIMEOUT\_MS:1000}
```

Настройки СУБД ADG
------
``` yaml
# настройка СУБД ADG
adg:
tarantool:
db:
# сетевой адрес хоста с СУБД ADG
      host: ${TARANTOOL\_DB\_HOST:10.92.3.120}
# сетевой адрес порта на хосте с СУБД ADG
      port: ${TARANTOOL\_DB\_PORT:3306}
# имя пользователя/логин для авторизации в СУБД ADG
      user: ${TARANTOOL\_DB\_USER:admin}
# пароль для авторизации в СУБД ADG
      password: ${TARANTOOL\_DB\_PASS:memstorage-cluster-cookie}
# максимальный интервал времени ожидания выполнения операции СУБД ADG до тайм-аута
      operationTimeout: ${TARANTOOL\_DB\_OPER\_TIMEOUT:60000}
# максимальное количество повторных попыток выполнения операции
      retryCount: ${TARANTOOL\_DB\_RETRY\_COUNT:0}
# движок СУБД ADG
      engine: ${TARANTOOL\_DEFAULT\_ENGINE:MEMTX}
# настройки картриджа Tatantool
    cartridge:
# сетевой путь и порт к картриджу Tarantool
      url: ${TARANTOOL\_CATRIDGE\_URL:http://10.92.3.120:8086}
# настройки механизма загрузки данных
mppw:
# наименование консьюмер-группы СУБД ADG для взаимодействия с брокером сообщений Kafka
    consumerGroup: ${ADG\_CONSUMER\_GROUP:tarantool-group-csv}
    kafka:
# максимальное количество сообщений в топике Kafka на раздел СУБД ADG
      maxNumberOfMessagesPerPartition: ${ADG\_MAX\_MSG\_PER\_PARTITION:200}
# время простоя (в секундах) callback-функции
      callbackFunctionSecIdle: ${ADG\_CB\_FUNC\_IDLE:100}
# настройки отката операции
rollback:
# размер пакета операций при откате
    eraseOperationBatchSize: ${ADG\_ROLLBACK\_OPERATION\_BATCH\_SIZE:300}
# настройки отказоустойчивости ADG по паттерну circuitbreaker
circuitbreaker:
# максимальное количество отказов ADG
    maxFailures: ${ADG\_CIRCUIT\_BREAKER\_MAX\_FAILURES:5}
# интервал времени фиксации отказа при пропадании отклика ADG
    timeout: ${ADG\_CIRCUIT\_BREAKER\_TIMEOUT:30000}
# использование паттерна fallback при отказе
    fallbackOnFailure: ${ADG\_CIRCUIT\_BREAKER\_FALLBACK\_ON\_FAILURE:false}
# интервал времени до сброса по паттерну timeout
    resetTimeout: ${ADG\_CIRCUIT\_BREAKER\_RESET\_TIMEOUT:10000}
# настройки для подключений веб-клиентов
web-client:
# максимальный размер пула подключений веб-клиентов к СУБД ADG
    max-pool-size: ${ADG\_WEB\_CLIENT\_MAX\_POOL\_SIZE:100}
```

Настройки СУБД ADQM
------
``` yaml
# настройки СУБД ADQM
adqm:
# настройка источника данных СУБД ADQM
datasource:
# наименование СУБД ADQM
    database: ${ADQM\_DB\_NAME:upload}
# имя пользователя/логин для авторизации в СУБД ADQM
    user: ${ADQM\_USERNAME:}
# пароль для авторизации в СУБД ADQM
    password: ${ADQM\_PASS:}
# сетевой адрес хоста с СУБД ADQM и номер порта на хосте
    hosts: ${ADQM\_HOSTS:10.92.3.30:8123}
# интервал времени ожидания отклика соединения с СУБД ADQM до тайм-аута
    socketTimeout: ${ADQM\_SOCKET\_TIMEOUT:30000}
# интервал времени ожидания завершения обмена данными с СУБД ADQM до тайм-аута
    dataTransferTimeout: ${ADQM\_DATA\_TRANSFER\_TIMEOUT:10000}
# настройки DDL-операторов
ddl:
# наименование кластера СУБД ADQM
    cluster: ${ADQM\_CLUSTER:test\_arenadata}
# настройки механизма выгрузки данных из ADQM
mppr:
# сетевой адрес коннектора выгрузки данных из ADQM
    host: ${ADQM\_MPPR\_CONNECTOR\_HOST:10.92.3.14}
# сетевой порт коннектора выгрузки данных из ADQM
    port: ${ADQM\_MPPR\_CONNECTOR\_PORT:8086}
# сетевой путь к коннектору выгрузки данных из ADQM
    url: ${ADQM\_MPPR\_CONNECTOR\_URL:/query}
# настройки механизма загрузки данных ADQM
mppw:
# наименование консьюмер-группы СУБД ADQM для загрузки данных в СУБД ADQM
# не используется
    consumerGroup: ${ADQM\_CONSUMER\_GROUP:adqm}
# сетевой адрес брокера сообщений Kafka
    kafkaBrokers: ${ADQM\_BROKERS:10.92.3.31:9092}
# тип интерфейса для загрузки данных в СУБД ADQM
    loadType: ${ADQM\_MPPW\_LOAD\_TYPE:REST}
# сетевой адрес и путь к REST-интерфейсу для загрузки новых данных в СУБД ADQM
    restStartLoadUrl: ${ADQM\_REST\_START\_LOAD\_URL:http://10.92.3.86:8090/newdata/adqm/start}
# сетевой адрес и путь к REST-интерфейсу для остановки загрузки данных в СУБД ADQM
    restStopLoadUrl: ${ADQM\_REST\_STOP\_LOAD\_URL:http://10.92.3.86:8090/newdata/adqm/stop}
# наименование коньсюмер-группы для загрузки данных в СУБД ADQM через REST API
    restLoadConsumerGroup: ${ADQM\_REST\_LOAD\_GROUP:adb-emulator-load-adqm}
# настройки для подключений веб-клиентов
web-client:
# максимальный размер пула подключений веб-клиентов к СУБД ADQM
    max-pool-size: ${ADQM\_WEB\_CLIENT\_MAX\_POOL\_SIZE:100}
```

Ниже представлен пример актуального файла конфигурации сервиса мониторинга статусов Kafka с комментариями, поясняющими назначение параметров.

Настройки сервиса мониторинга статусов Kafka
------
``` yaml
# настройки cервиса мониторинга статусов Kafka
monitor:
# список адресов брокеров сообщений Kafka
brokersList: ${STATUS\_MONITOR\_BROKERS:10.92.3.31:9092}
# количество потребителей (консьюмеров) cервиса мониторинга Kafka
consumersCount: ${STATUS\_MONITOR\_CONSUMERS:8}
```