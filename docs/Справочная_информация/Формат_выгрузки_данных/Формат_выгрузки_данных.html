<h1 id="формат-выгрузки-данных">Формат выгрузки данных</h1>

<p>Данные выгружаются из системы в следующем формате:</p>
<ul>
  <li>Выгрузка данных выполняется в топик Kafka, указанных в настройках внешней таблицы выгрузки.</li>
  <li>Тело сообщения содержит бинарный файл в формате Avro, состоящий из схемы данных и набора записей, 
которые соответствуют этой схеме данных.</li>
  <li>Схема данных тела сообщения содержит следующие элементы: имя, тип “record” и перечень полей. 
Для каждого поля указано имя, а также тип данных из числа перечисленных в разделе 
<a href="../Поддерживаемые_типы_данных/Выгружаемые_типы_данных/Выгружаемые_типы_данных.md">Выгружаемые типы данных</a> 
(см. пример <a href="#пример-выгружаемой-схемы-данных-avro">ниже</a>).</li>
  <li>Состав и порядок полей совпадают в следующих объектах:
    <ul>
      <li>во внешней таблице выгрузки,</li>
      <li>в схеме данных тела сообщения,</li>
      <li>в наборе выгружаемых записей.</li>
    </ul>
  </li>
</ul>

<p>Типы данных Avro, доступные к выгрузке из системы, описаны в разделе <a href="../Поддерживаемые_типы_данных/Выгружаемые_типы_данных/Выгружаемые_типы_данных.md">Выгружаемые типы данных</a>. 
Подробнее о формате Avro см. в официальной документации на сайте <a href="https://avro.apache.org/">https://avro.apache.org</a>.</p>

<h2 id="примеры">Примеры</h2>

<h3 id="пример-выгружаемой-схемы-данных-avro">Пример выгружаемой схемы данных Avro</h3>

<p>Пример ниже содержит схему данных Avro, выгружаемую с данными о продажах из СУБД ADB. Для наглядности 
примера бинарные данные представлены в <strong>JSON-формате</strong>.</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"row"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"record"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"identification_number"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"transaction_date"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"product_code"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"product_units"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"store_id"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"long"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"description"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="пример-выгружаемых-записей-avro">Пример выгружаемых записей Avro</h3>

<p>В примере ниже показан набор записей Avro о продажах, выгруженных из СУБД ADB и соответствующих схеме 
из предыдущего примера. Для наглядности примера бинарные данные представлены в <strong>JSON-формате</strong>.</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"identification_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000111</span><span class="p">,</span><span class="w">
    </span><span class="nl">"transaction_date"</span><span class="p">:</span><span class="w"> </span><span class="mi">1614269474000000</span><span class="p">,</span><span class="w">
    </span><span class="nl">"product_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ABC102101"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"product_units"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"store_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000012345</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Покупка по акции 1+1"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"identification_number"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000112</span><span class="p">,</span><span class="w">
    </span><span class="nl">"transaction_date"</span><span class="p">:</span><span class="w"> </span><span class="mi">1614334214000000</span><span class="p">,</span><span class="w">
    </span><span class="nl">"product_code"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ABC102001"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"product_units"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"store_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1000000123</span><span class="p">,</span><span class="w">
    </span><span class="nl">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Покупка без акций"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div></div>
